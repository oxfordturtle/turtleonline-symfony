{
  "format":1,
  "language":"Pascal",
  "version":13,
  "name":"Spread of disease",
  "author":"Peter Millican",
  "date":"31/08/2020",
  "time":"11:16:49",
  "code":"PROGRAM Disease;\nCONST width = 100;\n      height = 100;\n      susceptible = lightgreen;\n      infected = red;\n      recovered = blue;\n      startradius = 10;\n      infectprob = 1;\n      immuneprob = 2;\n      recoverprob = 15;\n      movement = false;\n      report = false;\nVAR x, y, n: integer;\n    x2, y2, swapcol: integer;\n    numimmune, numinfected, numinfectious: integer;\n\n  Procedure infect(x, y: integer);\n  Begin\n    pixset(x, y, infected);\n    inc(numinfected);\n    inc(numinfectious);\n    if report then\n      writeln('Infected: ' + pad(str(numinfected), ' ', 4) + '      Infectious: ' + pad(str(numinfectious),\n     ' ', 4))\n  End;\n\nBEGIN\n  canvas(0, 0, width, height);\n  resolution(width, height);\n  n := randseed(25);\n  timeset(0);\n  numimmune := 0;\n  numinfected := 0;\n  numinfectious := 0;\n  noupdate;\n  for x := 0 to width - 1 do\n    for y := 0 to height - 1 do\n      if (random(100) < infectprob) and (hypot(x - width / 2, y - height / 2, 1) <= startradius)\n     then\n        infect(x, y)\n      else\n      if random(100) < immuneprob then\n        begin\n          pixset(x, y, recovered);\n          inc(numimmune)\n        end\n      else\n        pixset(x, y, susceptible);\n  update;\n  repeat\n    x := random(width);\n    y := random(height);\n    if pixcol(x, y) = infected then\n      begin\n        if random(100) < recoverprob then\n          begin\n            pixset(x, y, recovered);\n            dec(numinfectious);\n            if report then\n              writeln('                    Infectious: ' + pad(str(numinfectious), ' ', 4))\n          end\n        else\n          begin\n            n := random(4) * 2 + 1;\n            x := x + n div 3 - 1;\n            y := y + n mod 3 - 1;\n            if pixcol(x, y) = susceptible then\n              infect(x, y)\n          end\n      end;\n    if movement then\n      begin\n        x := random(width);\n        y := random(height);\n        if pixcol(x, y) <> susceptible then\n          begin\n            x2 := random(width);\n            y2 := random(height);\n            swapcol := pixcol(x, y);\n            pixset(x, y, pixcol(x2, y2));\n            pixset(x2, y2, swapcol)\n          end\n      end\n  until numinfectious = 0;\n  writeln('Total infected overall: ' + str(numinfected) + ' (' + qstr(time, 1000, 2) + ' sec)');\n  writeln('Proportion infected:    ' + qstr(numinfected * 100, width * height - numimmune, 2) +\n     '%')\nEND.",
  "usage":[
    {
      "category": "Canvas operations",
      "expressions":[
        {"name":"noupdate", "level":1, "count":1, "lines":"35"},
        {"name":"update", "level":1, "count":1, "lines":"49"},
        {"name":"canvas", "level":2, "count":1, "lines":"28"},
        {"name":"resolution", "level":2, "count":1, "lines":"29"},
        {"name":"pixcol", "level":3, "count":5, "lines":"53 67 75 79 80"},
        {"name":"pixset", "level":3, "count":6, "lines":"19 44 48 57 80 81"}
      ],
      "total":15
    },
    {
      "category": "General arithmetic functions",
      "expressions":[
        {"name":"dec", "level":1, "count":1, "lines":"58"},
        {"name":"inc", "level":1, "count":3, "lines":"20 21 45"},
        {"name":"hypot", "level":2, "count":1, "lines":"38"},
        {"name":"random", "level":2, "count":10, "lines":"38 42 51 52 55 64 73 74 77 78"},
        {"name":"randseed", "level":3, "count":1, "lines":"30"}
      ],
      "total":16
    },
    {
      "category": "String operations",
      "expressions":[
        {"name":"writeln", "level":1, "count":4, "lines":"23 60 85 86"},
        {"name":"pad", "level":3, "count":3, "lines":"23 23 60"}
      ],
      "total":7
    },
    {
      "category": "Type conversion routines",
      "expressions":[
        {"name":"str", "level":1, "count":4, "lines":"23 23 60 85"},
        {"name":"qstr", "level":2, "count":2, "lines":"85 86"}
      ],
      "total":6
    },
    {
      "category": "Input and timing routines",
      "expressions":[
        {"name":"time", "level":2, "count":1, "lines":"85"},
        {"name":"timeset", "level":2, "count":1, "lines":"31"}
      ],
      "total":2
    },
    {
      "category": "Command structures",
      "expressions":[
        {"name":"if", "level":1, "count":9, "lines":"22 38 42 53 55 59 67 71 75"},
        {"name":"else", "level":1, "count":3, "lines":"41 47 62"},
        {"name":"for", "level":1, "count":2, "lines":"36 37"},
        {"name":"repeat", "level":2, "count":1, "lines":"50"},
        {"name":"procedure", "level":2, "count":1, "lines":"17"}
      ],
      "total":16
    },
    {
      "category": "Subroutine calls",
      "expressions":[
        {"name":"infect", "level":0, "count":2, "lines":"40 68"}
      ],
      "total":2
    }
  ],
  "pcode":[
    [112,13,1,1,112,0,123,112,6,2,123,4,112,15,124,112,28,138],
    [80,112,2,85,112,360,84,112,32,162,112,1,123,141,112,0,1,112,1000,1,1,1,145,144],
    [128,13],
    [133,1],
    [139,12,2],
    [120,12,2,120,12,1],
    [114,12,1,114,12,2,112,16711680,100],
    [116,27,1,122,4,2,123],
    [116,28,1,122,4,2,123],
    [112,0,129,12],
    [118,10,73,110,102,101,99,116,101,100,58,32,113,27,11,112,32,9,112,4,72,64,118,18,32,32,32,32,32,32,73,110,102,101,99,116,105,111,117,115,58,32,64,113,28,11,112,32,9,112,4,72,64,169,170,142],
    [140,12,134,132],
    [112,0,112,0,112,100,112,100,144],
    [112,100,112,100,145],
    [112,25,147,119,22],
    [112,0,173],
    [112,0,119,26],
    [112,0,119,27],
    [112,0,119,28],
    [112,0,146],
    [112,0],
    [119,20,112,100,112,1,27],
    [113,20,37,129,37],
    [112,0],
    [119,21,112,100,112,1,27],
    [113,21,37,129,36],
    [112,100,7,112,1,34,113,20,112,100,112,2,29,27,113,21,112,100,112,2,29,27,112,1,50,112,10,36,17,129,30],
    [113,20,113,21,131,4],
    [128,35],
    [112,100,7,112,2,34,129,34],
    [113,20,113,21,112,255,100],
    [116,26,1,122,4,2,123],
    [128,35],
    [113,20,113,21,112,10025880,100],
    [113,21,4,128,25],
    [113,20,4,128,22],
    [112,-1,146],
    [112,100,7,119,20],
    [112,100,7,119,21],
    [113,20,113,21,99,112,16711680,32,129,52],
    [112,100,7,112,15,34,129,47],
    [113,20,113,21,112,255,100],
    [116,28,1,122,5,2,123],
    [112,0,129,46],
    [118,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,73,110,102,101,99,116,105,111,117,115,58,32,113,28,11,112,32,9,112,4,72,64,169,170,142],
    [128,52],
    [112,4,7,112,2,28,112,1,26,119,22],
    [113,20,113,22,112,3,30,26,112,1,27,119,20],
    [113,21,113,22,112,3,31,26,112,1,27,119,21],
    [113,20,113,21,99,112,10025880,32,129,52],
    [113,20,113,21,131,4],
    [112,0,129,61],
    [112,100,7,119,20],
    [112,100,7,119,21],
    [113,20,113,21,99,112,10025880,33,129,61],
    [112,100,7,119,23],
    [112,100,7,119,24],
    [113,20,113,21,99,119,25],
    [113,20,113,21,113,23,113,24,99,100],
    [113,23,113,24,113,25,100],
    [113,28,112,0,32,129,38],
    [118,24,84,111,116,97,108,32,105,110,102,101,99,116,101,100,32,111,118,101,114,97,108,108,58,32,113,27,11,64,118,2,32,40,64,172,112,1000,112,2,14,64,118,5,32,115,101,99,41,64,169,170,142],
    [118,24,80,114,111,112,111,114,116,105,111,110,32,105,110,102,101,99,116,101,100,58,32,32,32,32,113,27,112,100,28,112,100,112,100,28,113,26,27,112,2,14,64,112,37,9,64,169,170,142],
    [130]
  ]
}
