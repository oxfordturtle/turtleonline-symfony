{
  "format":1,
  "language":"Pascal",
  "version":13,
  "name":"BarnsleyIFS",
  "author":"meriv",
  "date":"28/07/2020",
  "time":"08:25:08",
  "code":"PROGRAM BarnsleyIFS;\nCONST xleft = -236;\n      xright = 263;\n      ytop = 1;\n      ybottom = 1000;\n      scaledown = 3;\n      mappings = 4;\n      title = 'Barnsley fern';\n      live = green;\n      copied = emerald;\n      pauseval = 2000;\nVAR xl, xr, yt, yb: integer;\n    coeffdiv: integer;\n    mapxx, mapxy, mapxc: array[1..mappings] of integer;\n    mapyx, mapyy, mapyc: array[1..mappings] of integer;\n    iteration, starttime: integer;\n    count, numborn, numkilled: integer;\n\n  Procedure setmaps;\n  Begin\n    coeffdiv := 100;\n    mapxx[1] := 0;\n    mapyx[1] := 0;\n    mapxy[1] := 0;\n    mapyy[1] := 16;\n    mapxc[1] := 0;\n    mapyc[1] := 0;\n    mapxx[2] := 85;\n    mapyx[2] := -4;\n    mapxy[2] := 4;\n    mapyy[2] := 85;\n    mapxc[2] := 0;\n    mapyc[2] := 160;\n    mapxx[3] := 20;\n    mapyx[3] := 23;\n    mapxy[3] := -26;\n    mapyy[3] := 22;\n    mapxc[3] := 0;\n    mapyc[3] := 160;\n    mapxx[4] := -15;\n    mapyx[4] := 26;\n    mapxy[4] := 28;\n    mapyy[4] := 24;\n    mapxc[4] := 0;\n    mapyc[4] := 44\n  End;\n\n  Procedure setscale;\n  Var i: integer;\n  Begin\n    xl := xleft / scaledown;\n    xr := xright / scaledown;\n    yt := ytop / scaledown;\n    yb := ybottom / scaledown;\n    for i := 1 to mappings do\n      begin\n        mapxc[i] := mapxc[i] / scaledown;\n        mapyc[i] := mapyc[i] / scaledown\n      end\n  End;\n\n  Procedure map(a, x, y: integer; var newx, newy: integer);\n  Begin\n    newx := divmult(x, coeffdiv, mapxx[a]) + divmult(y, coeffdiv, mapxy[a]) + mapxc[a];\n    newy := divmult(x, coeffdiv, mapyx[a]) + divmult(y, coeffdiv, mapyy[a]) + mapyc[a]\n  End;\n\n  Procedure domap(mapnum: integer);\n  Var x, y, newx, newy: integer;\n  Begin\n    noupdate;\n    for y := yt to yb do\n      for x := xl to xr do\n        if pixcol(x, y) <> white then\n          begin\n            map(mapnum, x, y, newx, newy);\n            if pixcol(newx, newy) = white then\n              inc(numborn);\n            pixset(newx, newy, copied)\n          end;\n    update\n  End;\n\n  Procedure cleanup;\n  Var x, y: integer;\n  Begin\n    noupdate;\n    for y := yt to yb do\n      for x := xl to xr do\n        if pixcol(x, y) = live then\n          begin\n            pixset(x, y, white);\n            inc(numkilled)\n          end\n        else\n        if pixcol(x, y) = copied then\n          pixset(x, y, live);\n    update\n  End;\n\nBEGIN\n  setmaps;\n  setscale;\n  canvas(xl, yt, xr - xl + 1, yb - yt + 1);\n  resolution(xr - xl + 1, yb - yt + 1);\n  pixset(1, 1, live);\n  iteration := 0;\n  writeln(title + ' by iterative mapping');\n  timeset(0);\n  repeat\n    starttime := time;\n    inc(iteration);\n    writeln('');\n    writeln('Iteration ' + str(iteration) + ':');\n    numborn := 0;\n    for count := 1 to mappings do\n      domap(count);\n    numkilled := 0;\n    cleanup;\n    writeln('  ' + str(numborn) + ' pixels born; ' + str(numkilled) + ' pixels killed');\n    writeln('  (took ' + str((time - starttime) / 1000) + ' seconds - total ' + str(time / 1000) + ' seconds so far)');\n    if (numborn + numkilled > 0) and (pauseval >= 1000) then\n      begin\n        write('  (now pausing ' + qstr(pauseval, 1000, 1) + ' seconds to allow halting if desired ...)');\n        pause(pauseval);\n        writeln('')\n      end\n  until numborn + numkilled = 0;\n  writeln('FINISH - fixed point of iterative mapping has been reached')\nEND.\n",
  "usage":[
    {
      "category": "Canvas operations",
      "expressions":[
        {"name":"noupdate", "level":1, "count":2, "lines":"71 87"},
        {"name":"update", "level":1, "count":2, "lines":"81 98"},
        {"name":"canvas", "level":2, "count":1, "lines":"104"},
        {"name":"resolution", "level":2, "count":1, "lines":"105"},
        {"name":"pixcol", "level":3, "count":4, "lines":"74 77 90 96"},
        {"name":"pixset", "level":3, "count":4, "lines":"79 92 97 106"}
      ],
      "total":14
    },
    {
      "category": "General arithmetic functions",
      "expressions":[
        {"name":"inc", "level":1, "count":3, "lines":"78 93 112"},
        {"name":"divmult", "level":3, "count":4, "lines":"64 64 65 65"}
      ],
      "total":7
    },
    {
      "category": "String operations",
      "expressions":[
        {"name":"write", "level":1, "count":1, "lines":"124"},
        {"name":"writeln", "level":1, "count":7, "lines":"108 113 114 120 121 126 129"}
      ],
      "total":8
    },
    {
      "category": "Type conversion routines",
      "expressions":[
        {"name":"str", "level":1, "count":5, "lines":"114 120 120 121 121"},
        {"name":"qstr", "level":2, "count":1, "lines":"124"}
      ],
      "total":6
    },
    {
      "category": "Input and timing routines",
      "expressions":[
        {"name":"pause", "level":1, "count":1, "lines":"125"},
        {"name":"time", "level":2, "count":3, "lines":"111 121 121"},
        {"name":"timeset", "level":2, "count":1, "lines":"109"}
      ],
      "total":5
    },
    {
      "category": "Command structures",
      "expressions":[
        {"name":"if", "level":1, "count":5, "lines":"74 77 90 96 122"},
        {"name":"else", "level":1, "count":1, "lines":"95"},
        {"name":"for", "level":1, "count":6, "lines":"55 72 73 88 89 116"},
        {"name":"repeat", "level":2, "count":1, "lines":"110"},
        {"name":"procedure", "level":2, "count":5, "lines":"19 48 62 68 84"}
      ],
      "total":18
    },
    {
      "category": "Subroutine calls",
      "expressions":[
        {"name":"map", "level":0, "count":1, "lines":"76"},
        {"name":"setmaps", "level":0, "count":1, "lines":"102"},
        {"name":"setscale", "level":0, "count":1, "lines":"103"},
        {"name":"domap", "level":0, "count":1, "lines":"117"},
        {"name":"cleanup", "level":0, "count":1, "lines":"119"}
      ],
      "total":5
    }
  ],
  "pcode":[
    [112,17,1,1,112,0,123,112,6,2,123,4,112,52,124,112,69,138],
    [80,112,2,85,112,360,84,112,32,162,112,1,123,141,112,0,1,112,1000,1,1,1,145,144],
    [116,30,119,29],
    [112,4,119,30],
    [116,36,119,35],
    [112,4,119,36],
    [116,42,119,41],
    [112,4,119,42],
    [116,48,119,47],
    [112,4,119,48],
    [116,54,119,53],
    [112,4,119,54],
    [116,60,119,59],
    [112,4,119,60],
    [128,102],
    [133,1],
    [112,100,119,28],
    [113,29,112,1,112,1,27,2,127,26,4,112,0,2,123],
    [113,47,112,1,112,1,27,2,127,26,4,112,0,2,123],
    [113,35,112,1,112,1,27,2,127,26,4,112,0,2,123],
    [113,53,112,1,112,1,27,2,127,26,4,112,16,2,123],
    [113,41,112,1,112,1,27,2,127,26,4,112,0,2,123],
    [113,59,112,1,112,1,27,2,127,26,4,112,0,2,123],
    [113,29,112,2,112,1,27,2,127,26,4,112,85,2,123],
    [113,47,112,2,112,1,27,2,127,26,4,112,4,23,2,123],
    [113,35,112,2,112,1,27,2,127,26,4,112,4,2,123],
    [113,53,112,2,112,1,27,2,127,26,4,112,85,2,123],
    [113,41,112,2,112,1,27,2,127,26,4,112,0,2,123],
    [113,59,112,2,112,1,27,2,127,26,4,112,160,2,123],
    [113,29,112,3,112,1,27,2,127,26,4,112,20,2,123],
    [113,47,112,3,112,1,27,2,127,26,4,112,23,2,123],
    [113,35,112,3,112,1,27,2,127,26,4,112,26,23,2,123],
    [113,53,112,3,112,1,27,2,127,26,4,112,22,2,123],
    [113,41,112,3,112,1,27,2,127,26,4,112,0,2,123],
    [113,59,112,3,112,1,27,2,127,26,4,112,160,2,123],
    [113,29,112,4,112,1,27,2,127,26,4,112,15,23,2,123],
    [113,47,112,4,112,1,27,2,127,26,4,112,26,2,123],
    [113,35,112,4,112,1,27,2,127,26,4,112,28,2,123],
    [113,53,112,4,112,1,27,2,127,26,4,112,24,2,123],
    [113,41,112,4,112,1,27,2,127,26,4,112,0,2,123],
    [113,59,112,4,112,1,27,2,127,26,4,112,44,2,123],
    [134,132],
    [133,2],
    [139,13,1],
    [117,13,1,112,1,124],
    [112,-236,112,3,29,119,24],
    [112,263,112,3,29,119,25],
    [112,1,112,3,29,119,26],
    [112,1000,112,3,29,119,27],
    [112,1],
    [120,13,1,112,4],
    [114,13,1,37,129,56],
    [113,41,114,13,1,112,1,27,2,127,26,4,113,41,114,13,1,112,1,27,2,127,26,4,122,112,3,29,2,123],
    [113,59,114,13,1,112,1,27,2,127,26,4,113,59,114,13,1,112,1,27,2,127,26,4,122,112,3,29,2,123],
    [114,13,1,4,128,51],
    [140,13,134,132],
    [133,3],
    [139,14,5],
    [117,14,1,112,5,124,120,14,5,120,14,4,120,14,3,120,14,2,120,14,1],
    [114,14,2,113,28,113,29,114,14,1,112,1,27,2,127,26,4,122,48,114,14,3,113,28,113,35,114,14,1,112,1,27,2,127,26,4,122,48,26,113,41,114,14,1,112,1,27,2,127,26,4,122,26,121,14,4],
    [114,14,2,113,28,113,47,114,14,1,112,1,27,2,127,26,4,122,48,114,14,3,113,28,113,53,114,14,1,112,1,27,2,127,26,4,122,48,26,113,59,114,14,1,112,1,27,2,127,26,4,122,26,121,14,5],
    [140,14,134,132],
    [133,4],
    [139,15,5],
    [117,15,1,112,5,124,120,15,1],
    [112,0,146],
    [113,26],
    [120,15,3,113,27],
    [114,15,3,37,129,80],
    [113,24],
    [120,15,2,113,25],
    [114,15,2,37,129,79],
    [114,15,2,114,15,3,99,112,16777215,33,129,78],
    [114,15,1,114,15,2,114,15,3,117,15,4,117,15,5,131,57],
    [114,15,4,114,15,5,99,112,16777215,32,129,77],
    [116,68,1,122,4,2,123],
    [114,15,4,114,15,5,112,51543,100],
    [114,15,2,4,128,71],
    [114,15,3,4,128,68],
    [112,-1,146],
    [140,15,134,132],
    [133,5],
    [139,16,2],
    [117,16,1,112,2,124],
    [112,0,146],
    [113,26],
    [120,16,2,113,27],
    [114,16,2,37,129,100],
    [113,24],
    [120,16,1,113,25],
    [114,16,1,37,129,99],
    [114,16,1,114,16,2,99,112,2263842,32,129,96],
    [114,16,1,114,16,2,112,16777215,100],
    [116,69,1,122,4,2,123],
    [128,98],
    [114,16,1,114,16,2,99,112,51543,32,129,98],
    [114,16,1,114,16,2,112,2263842,100],
    [114,16,1,4,128,90],
    [114,16,2,4,128,87],
    [112,-1,146],
    [140,16,134,132],
    [131,16],
    [131,43],
    [113,24,113,26,113,25,113,24,27,112,1,26,113,27,113,26,27,112,1,26,144],
    [113,25,113,24,27,112,1,26,113,27,113,26,27,112,1,26,145],
    [112,1,112,1,112,2263842,100],
    [112,0,119,65],
    [118,13,66,97,114,110,115,108,101,121,32,102,101,114,110,118,21,32,98,121,32,105,116,101,114,97,116,105,118,101,32,109,97,112,112,105,110,103,64,169,170,142],
    [112,0,173],
    [172,119,66],
    [116,65,1,122,4,2,123],
    [118,0,169,170,142],
    [118,10,73,116,101,114,97,116,105,111,110,32,113,65,11,64,112,58,9,64,169,170,142],
    [112,0,119,68],
    [112,1],
    [119,67,112,4],
    [113,67,37,129,120],
    [113,67,131,63],
    [113,67,4,128,116],
    [112,0,119,69],
    [131,82],
    [118,2,32,32,113,68,11,64,118,14,32,112,105,120,101,108,115,32,98,111,114,110,59,32,64,113,69,11,64,118,14,32,112,105,120,101,108,115,32,107,105,108,108,101,100,64,169,170,142],
    [118,8,32,32,40,116,111,111,107,32,172,113,66,27,112,1000,29,11,64,118,17,32,115,101,99,111,110,100,115,32,45,32,116,111,116,97,108,32,64,172,112,1000,29,11,64,118,16,32,115,101,99,111,110,100,115,32,115,111,32,102,97,114,41,64,169,170,142],
    [113,68,113,69,26,112,0,35,112,2000,112,1000,37,17,129,128],
    [118,15,32,32,40,110,111,119,32,112,97,117,115,105,110,103,32,112,2000,112,1000,112,1,14,64,118,41,32,115,101,99,111,110,100,115,32,116,111,32,97,108,108,111,119,32,104,97,108,116,105,110,103,32,105,102,32,100,101,115,105,114,101,100,32,46,46,46,41,64,169,142],
    [112,2000,174],
    [118,0,169,170,142],
    [113,68,113,69,26,112,0,32,129,110],
    [118,58,70,73,78,73,83,72,32,45,32,102,105,120,101,100,32,112,111,105,110,116,32,111,102,32,105,116,101,114,97,116,105,118,101,32,109,97,112,112,105,110,103,32,104,97,115,32,98,101,101,110,32,114,101,97,99,104,101,100,169,170,142],
    [130]
  ]
}
