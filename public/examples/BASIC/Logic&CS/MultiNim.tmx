{
  "format":1,
  "language":"BASIC",
  "version":13,
  "name":"Nim with multiple piles",
  "author":"Peter Millican",
  "date":"28/07/2020",
  "time":"13:25:48",
  "code":"REM MultiNim\n\nCONST PILES%=5\nCONST MAXHEIGHT%=8\nCONST MARGIN%=20\nDIM pile%(PILES%)\nPROCsetup\nREPEAT\n PROCfixpiles\n REPEAT\n  PROCdomaths\n  PROCdrawpiles\n  REPEAT\n   CURSOR(2)\n   REPEAT\n    REPEAT\n    UNTIL ?LMOUSE>0\n    PAUSE(200)\n    thiscolour%=PIXCOL(?CLICKX,?CLICKY)\n   UNTIL (thiscolour%<>RGB(WHITE)) AND (thiscolour%<>RGB(BLACK))\n   CURSOR(11)\n   IF ?CLICKY>=800 THEN\n    thiscoin%=MAXHEIGHT%+1\n    showmaths%=NOT(showmaths%)\n    PROCdomaths\n    PROCdrawpiles\n   ELSE\n    thispile%=(?CLICKX-MARGIN%+radius%) DIV xgap%+1\n    thiscoin%=(bottom%-radius%-?CLICKY) DIV ygap%+1\n   ENDIF\n  UNTIL (?CLICKY<800)\n  pile%(thispile%)=thiscoin%-1\n  PROCdomaths\n  IF totalcoins%=0 THEN\n   BLANK(WHITE)\n   SETXY(330,850)\n   COLOUR(BLUE)\n   PRINT(\"You Win!\",4,60)\n   PAUSE(5000)\n  ELSE\n   PROCdrawpiles\n   PAUSE(1000)\n   PROCblackout(autopile%,autocoin%)\n   pile%(autopile%)=autocoin%-1\n   PROCdomaths\n   IF (xorscore%=0) AND NOT(showmaths%) THEN\n    COLOUR(PINK)\n    SETXY(400,900)\n    PRINT(\"I'm going to win!\",4,30)\n   ENDIF\n   PAUSE(2500)\n   IF totalcoins%=0 THEN\n    BLANK(WHITE)\n    SETXY(330,850)\n    COLOUR(RED)\n    PRINT(\"I Win!\",4,60)\n    PAUSE(5000)\n   ENDIF\n  ENDIF\n UNTIL totalcoins%=0\nUNTIL 0=1\nEND\n\nDEF PROCsetup\n xgap%=(1000-2*MARGIN%) DIV PILES%\n ygap%=(800-MARGIN%) DIV MAXHEIGHT%\n IF ygap%*MAXHEIGHT%>800 THEN ygap%=800 DIV MAXHEIGHT%\n radius%=(ygap%-MARGIN%) DIV 2\n left%=MARGIN%+radius%-xgap%\n bottom%=800-radius%+ygap%\n showmaths%=FALSE\nENDPROC\n\nDEF PROCfixpiles\n LOCAL p%\n FOR p%=1 TO PILES%\n  pile%(p%)=RND(MAXHEIGHT%)\n NEXT\nENDPROC\n\nDEF PROCdomaths\n LOCAL p%\n totalcoins%=0\n xorscore%=0\n FOR p%=1 TO PILES%\n  totalcoins%=totalcoins%+pile%(p%)\n  xorscore%=xorscore% EOR pile%(p%)\n NEXT\nENDPROC\n\nDEF PROCdrawpiles\n LOCAL p%,c%,autocount%\n BLANK(WHITE)\n autocount%=RND(totalcoins%)\n FOR p%=1 TO PILES%\n  c%=pile%(p%)\n  WHILE c%>0\n   DEC(autocount%)\n   IF autocount%=0 THEN\n    autopile%=p%\n    autocoin%=c%\n   ENDIF\n   SETXY(left%+xgap%*p%,bottom%-ygap%*c%)\n   COLOUR(RGB(p%))\n   BLOT(radius%)\n   IF xorscore% EOR pile%(p%) EOR (c%-1)=0 THEN\n    autopile%=p%\n    autocoin%=c%\n    autocount%=0\n   ENDIF\n   IF showmaths% THEN\n    MOVEXY(radius%+MARGIN%,-radius%+15)\n    COLOUR(BLACK)\n    PRINT(STR$(xorscore% EOR pile%(p%) EOR (c%-1)),4,20)\n   ENDIF\n   DEC(c%)\n  ENDWHILE\n NEXT\n COLOUR(BLACK)\n SETXY(MARGIN%,900)\n PRINT(\"Total Coins:  \"+STR$(totalcoins%),4,30)\n IF showmaths% THEN\n  COLOUR(BLACK)\n  SETXY(450,900)\n  PRINT(\"XOR score:  \"+STR$(xorscore%),4,30)\n  SETXY(850,890)\n  COLOUR(MAROON)\n  BOX(140,100,RED,TRUE)\n  PRINT(\" HIDE\",4,25)\n  SETXY(850,940)\n  PRINT(\" MATHS\",4,25)\n ELSE\n  COLOUR(MAROON)\n  SETXY(850,890)\n  BOX(140,100,RED,TRUE)\n  PRINT(\" SHOW\",4,25)\n  SETXY(850,940)\n  PRINT(\" MATHS\",4,25)\n ENDIF\nENDPROC\n\nDEF PROCblackout(p%,c%)\n SETXY(left%+xgap%*p%,bottom%-ygap%*c%)\n COLOUR(BLACK)\n BLOT(radius%)\nENDPROC",
  "usage":[
    {
      "category": "Turtle: relative movement",
      "expressions":[
        {"name":"MOVEXY", "level":2, "count":1, "lines":"112"}
      ],
      "total":1
    },
    {
      "category": "Turtle: absolute movement",
      "expressions":[
        {"name":"SETXY", "level":1, "count":11, "lines":"103 120 124 126 130 134 137 143 36 48 54"}
      ],
      "total":11
    },
    {
      "category": "Turtle: drawing shapes",
      "expressions":[
        {"name":"BLOT", "level":1, "count":2, "lines":"105 145"},
        {"name":"BOX", "level":2, "count":2, "lines":"128 135"}
      ],
      "total":4
    },
    {
      "category": "Other Turtle commands",
      "expressions":[
        {"name":"COLOUR", "level":1, "count":10, "lines":"104 113 119 123 127 133 144 37 47 55"},
        {"name":"RGB", "level":3, "count":3, "lines":"104 20 20"}
      ],
      "total":13
    },
    {
      "category": "Canvas operations",
      "expressions":[
        {"name":"BLANK", "level":1, "count":3, "lines":"93 35 53"},
        {"name":"PIXCOL", "level":3, "count":1, "lines":"19"}
      ],
      "total":4
    },
    {
      "category": "General arithmetic functions",
      "expressions":[
        {"name":"DEC", "level":1, "count":2, "lines":"98 116"},
        {"name":"RND", "level":2, "count":2, "lines":"77 94"}
      ],
      "total":4
    },
    {
      "category": "String operations",
      "expressions":[
        {"name":"PRINT", "level":1, "count":10, "lines":"114 121 125 129 131 136 138 38 49 56"}
      ],
      "total":10
    },
    {
      "category": "Type conversion routines",
      "expressions":[
        {"name":"STR$", "level":1, "count":3, "lines":"114 121 125"}
      ],
      "total":3
    },
    {
      "category": "Input and timing routines",
      "expressions":[
        {"name":"PAUSE", "level":1, "count":5, "lines":"18 39 42 51 57"},
        {"name":"CURSOR", "level":2, "count":2, "lines":"14 21"}
      ],
      "total":7
    },
    {
      "category": "Command structures",
      "expressions":[
        {"name":"IF", "level":1, "count":9, "lines":"67 99 106 111 122 22 34 46 52"},
        {"name":"ELSE", "level":1, "count":3, "lines":"132 27 40"},
        {"name":"FOR", "level":1, "count":3, "lines":"76 85 95"},
        {"name":"REPEAT", "level":2, "count":5, "lines":"8 10 13 15 16"},
        {"name":"WHILE", "level":2, "count":1, "lines":"97"},
        {"name":"DEF PROC", "level":2, "count":5, "lines":"64 74 81 91 142"}
      ],
      "total":26
    },
    {
      "category": "Subroutine calls",
      "expressions":[
        {"name":"PROCsetup", "level":0, "count":1, "lines":"7"},
        {"name":"PROCfixpiles", "level":0, "count":1, "lines":"9"},
        {"name":"PROCdomaths", "level":0, "count":4, "lines":"11 25 33 45"},
        {"name":"PROCdrawpiles", "level":0, "count":3, "lines":"12 26 41"},
        {"name":"PROCblackout", "level":0, "count":1, "lines":"43"}
      ],
      "total":10
    }
  ],
  "pcode":[
    [112,17,1,1,112,0,123,112,6,2,123,4,112,27,124,112,44,138],
    [80,112,2,85,112,360,84,112,32,162,112,1,123,141,112,0,1,112,1000,1,1,1,145,144],
    [116,25,119,24],
    [112,6,119,25],
    [128,93],
    [133,1],
    [112,1000,112,2,112,20,28,27,112,5,30,119,36],
    [112,800,112,20,27,112,8,30,119,37],
    [113,37,112,8,28,112,800,35,129,11],
    [112,800,112,8,30,119,37],
    [113,37,112,20,27,112,2,30,119,38],
    [112,20,113,38,26,113,36,27,119,39],
    [112,800,113,38,27,113,37,26,119,40],
    [112,0,119,34],
    [134,132],
    [133,2],
    [139,13,1],
    [117,13,1,112,1,124],
    [112,1],
    [120,13,1,112,5],
    [114,13,1,37,129,24],
    [113,24,114,13,1,2,127,26,4,112,8,7,4,2,123],
    [114,13,1,4,128,20],
    [140,13,134,132],
    [133,3],
    [139,14,1],
    [117,14,1,112,1,124],
    [112,0,119,41],
    [112,0,119,42],
    [112,1],
    [120,14,1,112,5],
    [114,14,1,37,129,36],
    [113,41,113,24,114,14,1,2,127,26,4,122,26,119,41],
    [113,42,113,24,114,14,1,2,127,26,4,122,19,119,42],
    [114,14,1,4,128,31],
    [140,14,134,132],
    [133,4],
    [139,15,3],
    [117,15,1,112,3,124],
    [112,16777215,96],
    [113,41,7,4,120,15,3],
    [112,1],
    [120,15,1,112,5],
    [114,15,1,37,129,65],
    [113,24,114,15,1,2,127,26,4,122,120,15,2],
    [114,15,2,112,0,35,129,64],
    [117,15,3,1,122,5,2,123],
    [114,15,3,112,0,32,129,51],
    [114,15,1,119,43],
    [114,15,2,119,44],
    [113,39,113,36,114,15,1,28,26,113,40,113,37,114,15,2,28,27,88],
    [114,15,1,101,87],
    [113,38,108],
    [113,42,113,24,114,15,1,2,127,26,4,122,19,114,15,2,112,1,27,19,112,0,32,129,58],
    [114,15,1,119,43],
    [114,15,2,119,44],
    [112,0,120,15,3],
    [113,34,129,62],
    [113,38,112,20,26,113,38,23,112,15,26,89],
    [112,0,87],
    [113,42,113,24,114,15,1,2,127,26,4,122,19,114,15,2,112,1,27,19,11,112,4,112,20,168,142],
    [117,15,2,1,122,5,2,123],
    [128,46],
    [114,15,1,4,128,43],
    [112,0,87],
    [112,20,112,900,88],
    [118,14,84,111,116,97,108,32,67,111,105,110,115,58,32,32,113,41,11,64,112,4,112,30,168,142],
    [113,34,129,79],
    [112,0,87],
    [112,450,112,900,88],
    [118,12,88,79,82,32,115,99,111,114,101,58,32,32,113,42,11,64,112,4,112,30,168,142],
    [112,850,112,890,88],
    [112,8388608,87],
    [112,140,112,100,112,16711680,112,-1,111],
    [118,5,32,72,73,68,69,112,4,112,25,168,142],
    [112,850,112,940,88],
    [118,6,32,77,65,84,72,83,112,4,112,25,168,142],
    [128,85],
    [112,8388608,87],
    [112,850,112,890,88],
    [112,140,112,100,112,16711680,112,-1,111],
    [118,5,32,83,72,79,87,112,4,112,25,168,142],
    [112,850,112,940,88],
    [118,6,32,77,65,84,72,83,112,4,112,25,168,142],
    [140,15,134,132],
    [133,5],
    [139,16,2],
    [117,16,1,112,2,124,120,16,2,120,16,1],
    [113,39,113,36,114,16,1,28,26,113,40,113,37,114,16,2,28,27,88],
    [112,0,87],
    [113,38,108],
    [140,16,134,132],
    [131,6],
    [131,16],
    [131,25],
    [131,37],
    [112,2,171],
    [112,-1,160,112,0,35,129,98],
    [112,200,174],
    [112,-5,160,112,-6,160,99,119,32],
    [113,32,112,16777215,101,33,113,32,112,0,101,33,17,129,98],
    [112,11,171],
    [112,-6,160,112,800,37,129,109],
    [112,8,112,1,26,119,33],
    [113,34,16,119,34],
    [131,25],
    [131,37],
    [128,111],
    [112,-5,160,112,20,27,113,38,26,113,36,30,112,1,26,119,35],
    [113,40,113,38,27,112,-6,160,27,113,37,30,112,1,26,119,33],
    [112,-6,160,112,800,34,129,97],
    [113,24,113,35,2,127,26,4,113,33,112,1,27,2,123],
    [131,25],
    [113,41,112,0,32,129,121],
    [112,16777215,96],
    [112,330,112,850,88],
    [112,255,87],
    [118,8,89,111,117,32,87,105,110,33,112,4,112,60,168,142],
    [112,5000,174],
    [128,137],
    [131,37],
    [112,1000,174],
    [113,43,113,44,131,86],
    [113,24,113,43,2,127,26,4,113,44,112,1,27,2,123],
    [131,25],
    [113,42,112,0,32,113,34,16,17,129,130],
    [112,15602313,87],
    [112,400,112,900,88],
    [118,17,73,39,109,32,103,111,105,110,103,32,116,111,32,119,105,110,33,112,4,112,30,168,142],
    [112,2500,174],
    [113,41,112,0,32,129,137],
    [112,16777215,96],
    [112,330,112,850,88],
    [112,16711680,87],
    [118,6,73,32,87,105,110,33,112,4,112,60,168,142],
    [112,5000,174],
    [113,41,112,0,32,129,95],
    [112,0,112,1,32,129,94],
    [130]
  ]
}
