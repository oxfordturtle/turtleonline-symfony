{
  "format":1,
  "language":"BASIC",
  "version":13,
  "name":"Town road simulation",
  "author":"Peter Millican",
  "date":"28/07/2020",
  "time":"13:25:40",
  "code":"REM Roads\n\nCONST MAXNODES%=500\nCONST SUFFNODES%=400\nCONST MAXEDGES%=1000\nCONST MINDISTANCE%=40\nCONST NODERADIUS%=6\nCONST ROADRADIUS%=4\nCONST NORMALROAD%=BLACK\nCONST LINKROAD%=BLUE\nDIM nodex%(MAXNODES%)\nDIM nodey%(MAXNODES%)\nDIM nodedist%(MAXNODES%)\nDIM edge1%(MAXEDGES%)\nDIM edge2%(MAXEDGES%)\nDIM edgelen%(MAXEDGES%)\nTHICKNESS(6)\nnumnodes%=0\nnumedges%=0\nWHILE numnodes%<SUFFNODES%\n INC(numnodes%)\n REPEAT\n  nodex%(numnodes%)=RND(1000)\n  nodey%(numnodes%)=RND(1000)\n  m%=FNclosest(numnodes%)\n UNTIL m%>=0\n PROCmarknode(numnodes%,RED,NODERADIUS%)\n IF m%>0 THEN\n  PROClinkup(m%,numnodes%)\n ENDIF\nENDWHILE\nFOR m%=1 TO numnodes%\n PROCjoinup(m%)\nNEXT\nEND\n\nDEF FNclosest(n%)\n LOCAL i%,min%,d%\n result%=0\n min%=MAXINT\n FOR i%=1 TO numnodes%\n  IF i%<>n% THEN\n   d%=HYPOT(nodex%(n%)-nodex%(i%),nodey%(n%)-nodey%(i%),1)\n   IF d%<min% THEN\n    min%=d%\n    result%=i%\n   ENDIF\n  ENDIF\n NEXT\n IF min%<MINDISTANCE% THEN\n  result%=-1\n ENDIF\n=result%\n\nDEF PROCmarknode(n%,col%,rad%)\n SETXY(nodex%(n%),nodey%(n%))\n COLOUR(col%)\n BLOT(rad%)\nENDPROC\n\nDEF PROCmakeedge(nodea%,nodeb%,col%)\n INC(numedges%)\n edge1%(numedges%)=nodea%\n edge2%(numedges%)=nodeb%\n edgelen%(numedges%)=HYPOT(nodex%(nodea%)-nodex%(nodeb%),nodey%(nodea%)-nodey%(nodeb%),1)\n SETXY(nodex%(nodea%),nodey%(nodea%))\n COLOUR(col%)\n SETXY(nodex%(nodeb%),nodey%(nodeb%))\n POLYLINE(2)\nENDPROC\n\nDEF PROClinkup(nodea%,nodeb%)\n IF HYPOT(nodex%(nodea%)-nodex%(nodeb%),nodey%(nodea%)-nodey%(nodeb%),1)<MINDISTANCE%*2 THEN\n  PROCmakeedge(nodea%,nodeb%,NORMALROAD%)\n ELSE\n  INC(numnodes%)\n  nodex%(numnodes%)=(nodex%(nodea%)+nodex%(nodeb%))/2\n  nodey%(numnodes%)=(nodey%(nodea%)+nodey%(nodeb%))/2\n  PROCmarknode(numnodes%,CYAN,ROADRADIUS%)\n  PROClinkup(nodea%,numnodes%)\n  PROClinkup(numnodes%,nodeb%)\n ENDIF\nENDPROC\n\nDEF PROCjoinup(thisnode%)\n LOCAL i%,j%,dist%,continue%\n FOR i%=1 TO numnodes%\n  nodedist%(i%)=MAXINT\n NEXT\n nodedist%(thisnode%)=0\n continue%=TRUE\n WHILE continue%\n  continue%=FALSE\n  FOR i%=1 TO numedges%\n   IF nodedist%(edge1%(i%))<MAXINT THEN\n    IF nodedist%(edge1%(i%))+edgelen%(i%)<nodedist%(edge2%(i%)) THEN\n     nodedist%(edge2%(i%))=nodedist%(edge1%(i%))+edgelen%(i%)\n     continue%=TRUE\n    ENDIF\n   ENDIF\n   IF nodedist%(edge2%(i%))<MAXINT THEN\n    IF nodedist%(edge2%(i%))+edgelen%(i%)<nodedist%(edge1%(i%)) THEN\n     nodedist%(edge1%(i%))=nodedist%(edge2%(i%))+edgelen%(i%)\n     continue%=TRUE\n    ENDIF\n   ENDIF\n  NEXT\n ENDWHILE\n i%=0\n continue%=TRUE\n WHILE (i%<numnodes%) AND continue%\n  INC(i%)\n  dist%=HYPOT(nodex%(i%)-nodex%(thisnode%),nodey%(i%)-nodey%(thisnode%),1)\n  IF (i%<>thisnode%) AND (nodedist%(i%)>1000) AND (dist%<MINDISTANCE%*2) THEN\n   PROCmakeedge(thisnode%,i%,LINKROAD%)\n   continue%=FALSE\n  ENDIF\n ENDWHILE\nENDPROC",
  "usage":[
    {
      "category": "Turtle: absolute movement",
      "expressions":[
        {"name":"SETXY", "level":1, "count":3, "lines":"56 66 68"}
      ],
      "total":3
    },
    {
      "category": "Turtle: drawing shapes",
      "expressions":[
        {"name":"BLOT", "level":1, "count":1, "lines":"58"},
        {"name":"POLYLINE", "level":2, "count":1, "lines":"69"}
      ],
      "total":2
    },
    {
      "category": "Other Turtle commands",
      "expressions":[
        {"name":"COLOUR", "level":1, "count":2, "lines":"57 67"},
        {"name":"THICKNESS", "level":1, "count":1, "lines":"17"}
      ],
      "total":3
    },
    {
      "category": "General arithmetic functions",
      "expressions":[
        {"name":"INC", "level":1, "count":4, "lines":"62 76 112 21"},
        {"name":"HYPOT", "level":2, "count":4, "lines":"43 65 73 113"},
        {"name":"RND", "level":2, "count":2, "lines":"23 24"},
        {"name":"MAXINT", "level":3, "count":4, "lines":"40 88 95 101"}
      ],
      "total":14
    },
    {
      "category": "Command structures",
      "expressions":[
        {"name":"IF", "level":1, "count":10, "lines":"42 44 50 73 95 96 101 102 114 28"},
        {"name":"ELSE", "level":1, "count":1, "lines":"75"},
        {"name":"FOR", "level":1, "count":4, "lines":"41 87 94 32"},
        {"name":"REPEAT", "level":2, "count":1, "lines":"22"},
        {"name":"WHILE", "level":2, "count":3, "lines":"92 111 20"},
        {"name":"DEF PROC", "level":2, "count":4, "lines":"55 61 72 85"},
        {"name":"DEF FN", "level":3, "count":1, "lines":"37"}
      ],
      "total":24
    },
    {
      "category": "Subroutine calls",
      "expressions":[
        {"name":"PROCmakeedge", "level":0, "count":2, "lines":"74 115"},
        {"name":"PROCmarknode", "level":0, "count":2, "lines":"79 27"},
        {"name":"PROClinkup", "level":0, "count":3, "lines":"80 81 29"},
        {"name":"FNclosest", "level":0, "count":1, "lines":"25"},
        {"name":"PROCjoinup", "level":0, "count":1, "lines":"33"}
      ],
      "total":9
    }
  ],
  "pcode":[
    [112,18,1,1,112,0,123,112,6,2,123,4,112,4528,124,112,4546,138],
    [80,112,2,85,112,360,84,112,32,162,112,1,123,141,112,0,1,112,1000,1,1,1,145,144],
    [116,26,119,25],
    [112,501,119,26],
    [116,529,119,528],
    [112,501,119,529],
    [116,1032,119,1031],
    [112,501,119,1032],
    [116,1535,119,1534],
    [112,1001,119,1535],
    [116,2538,119,2537],
    [112,1001,119,2538],
    [116,3541,119,3540],
    [112,1001,119,3541],
    [128,101],
    [133,1],
    [139,12,5],
    [117,12,1,112,5,124,120,12,2],
    [112,0,119,4546],
    [6,120,12,4],
    [112,1],
    [120,12,3,113,4543],
    [114,12,3,37,129,30],
    [114,12,3,114,12,2,33,129,29],
    [113,25,114,12,2,2,127,26,4,122,113,25,114,12,3,2,127,26,4,122,27,113,528,114,12,2,2,127,26,4,122,113,528,114,12,3,2,127,26,4,122,27,112,1,50,120,12,5],
    [114,12,5,114,12,4,34,129,29],
    [114,12,5,120,12,4],
    [114,12,3,119,4546],
    [114,12,3,4,128,22],
    [114,12,4,112,40,34,129,32],
    [112,1,23,119,4546],
    [113,4546,120,12,1],
    [113,12,119,17,140,12,134,132],
    [133,2],
    [139,13,3],
    [117,13,1,112,3,124,120,13,3,120,13,2,120,13,1],
    [113,25,114,13,1,2,127,26,4,122,113,528,114,13,1,2,127,26,4,122,88],
    [114,13,2,87],
    [114,13,3,108],
    [140,13,134,132],
    [133,3],
    [139,14,3],
    [117,14,1,112,3,124,120,14,3,120,14,2,120,14,1],
    [116,4544,1,122,4,2,123],
    [113,1534,113,4544,2,127,26,4,114,14,1,2,123],
    [113,2537,113,4544,2,127,26,4,114,14,2,2,123],
    [113,3540,113,4544,2,127,26,4,113,25,114,14,1,2,127,26,4,122,113,25,114,14,2,2,127,26,4,122,27,113,528,114,14,1,2,127,26,4,122,113,528,114,14,2,2,127,26,4,122,27,112,1,50,2,123],
    [113,25,114,14,1,2,127,26,4,122,113,528,114,14,1,2,127,26,4,122,88],
    [114,14,3,87],
    [113,25,114,14,2,2,127,26,4,122,113,528,114,14,2,2,127,26,4,122,88],
    [112,2,105],
    [140,14,134,132],
    [133,4],
    [139,15,2],
    [117,15,1,112,2,124,120,15,2,120,15,1],
    [113,25,114,15,1,2,127,26,4,122,113,25,114,15,2,2,127,26,4,122,27,113,528,114,15,1,2,127,26,4,122,113,528,114,15,2,2,127,26,4,122,27,112,1,50,112,40,112,2,28,34,129,59],
    [114,15,1,114,15,2,112,0,131,41],
    [128,65],
    [116,4543,1,122,4,2,123],
    [113,25,113,4543,2,127,26,4,113,25,114,15,1,2,127,26,4,122,113,25,114,15,2,2,127,26,4,122,26,112,2,29,2,123],
    [113,528,113,4543,2,127,26,4,113,528,114,15,1,2,127,26,4,122,113,528,114,15,2,2,127,26,4,122,26,112,2,29,2,123],
    [113,4543,112,65535,112,4,131,34],
    [114,15,1,113,4543,131,53],
    [113,4543,114,15,2,131,53],
    [140,15,134,132],
    [133,5],
    [139,16,5],
    [117,16,1,112,5,124,120,16,1],
    [112,1],
    [120,16,2,113,4543],
    [114,16,2,37,129,74],
    [113,1031,114,16,2,2,127,26,4,6,2,123],
    [114,16,2,4,128,70],
    [113,1031,114,16,1,2,127,26,4,112,0,2,123],
    [112,-1,120,16,5],
    [114,16,5,129,91],
    [112,0,120,16,5],
    [112,1],
    [120,16,2,113,4544],
    [114,16,2,37,129,90],
    [113,1031,113,1534,114,16,2,2,127,26,4,122,2,127,26,4,122,6,34,129,85],
    [113,1031,113,1534,114,16,2,2,127,26,4,122,2,127,26,4,122,113,3540,114,16,2,2,127,26,4,122,26,113,1031,113,2537,114,16,2,2,127,26,4,122,2,127,26,4,122,34,129,85],
    [113,1031,113,2537,114,16,2,2,127,26,4,122,2,127,26,4,113,1031,113,1534,114,16,2,2,127,26,4,122,2,127,26,4,122,113,3540,114,16,2,2,127,26,4,122,26,2,123],
    [112,-1,120,16,5],
    [113,1031,113,2537,114,16,2,2,127,26,4,122,2,127,26,4,122,6,34,129,89],
    [113,1031,113,2537,114,16,2,2,127,26,4,122,2,127,26,4,122,113,3540,114,16,2,2,127,26,4,122,26,113,1031,113,1534,114,16,2,2,127,26,4,122,2,127,26,4,122,34,129,89],
    [113,1031,113,1534,114,16,2,2,127,26,4,122,2,127,26,4,113,1031,113,2537,114,16,2,2,127,26,4,122,2,127,26,4,122,113,3540,114,16,2,2,127,26,4,122,26,2,123],
    [112,-1,120,16,5],
    [114,16,2,4,128,79],
    [128,76],
    [112,0,120,16,2],
    [112,-1,120,16,5],
    [114,16,2,113,4543,34,114,16,5,17,129,100],
    [117,16,2,1,122,4,2,123],
    [113,25,114,16,2,2,127,26,4,122,113,25,114,16,1,2,127,26,4,122,27,113,528,114,16,2,2,127,26,4,122,113,528,114,16,1,2,127,26,4,122,27,112,1,50,120,16,4],
    [114,16,2,114,16,1,33,113,1031,114,16,2,2,127,26,4,122,112,1000,35,17,114,16,4,112,40,112,2,28,34,17,129,99],
    [114,16,1,114,16,2,112,255,131,41],
    [112,0,120,16,5],
    [128,93],
    [140,16,134,132],
    [112,6,85],
    [112,0,119,4543],
    [112,0,119,4544],
    [113,4543,112,400,34,129,115],
    [116,4543,1,122,4,2,123],
    [113,25,113,4543,2,127,26,4,112,1000,7,4,2,123],
    [113,528,113,4543,2,127,26,4,112,1000,7,4,2,123],
    [113,4543,131,16],
    [114,17,1,119,4545],
    [113,4545,112,0,37,129,106],
    [113,4543,112,16711680,112,6,131,34],
    [113,4545,112,0,35,129,114],
    [113,4545,113,4543,131,53],
    [128,104],
    [112,1],
    [119,4545,113,4543],
    [113,4545,37,129,120],
    [113,4545,131,66],
    [113,4545,4,128,116],
    [130]
  ]
}
