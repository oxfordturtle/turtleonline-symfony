{
  "format":1,
  "language":"BASIC",
  "version":13,
  "name":"Brownian motion",
  "author":"Peter Millican",
  "date":"23/07/2020",
  "time":"12:00:30",
  "code":"REM BrownianMotion\n\nCONST POLRADIUS% = 80\nCONST MOLRADIUS% = 10\nCONST HITRADIUS% = 90\nCONST MOLECULES% = 400\nCONST SLOWSPEED% = 30\nCONST HIGHSPEED% = 50\nCONST SPEEDRATIO% = 10\nCONST POLCOLOUR% = BLUE\nCONST MOLCOLOUR% = RED\nCONST HALOCOLOUR% = &FFFFFE\nCONST DELAY% = 50\nDIM mx%(MOLECULES%)\nDIM my%(MOLECULES%)\nDIM ms%(MOLECULES%)\nDIM md%(MOLECULES%)\nNOUPDATE\nPROCsetup\nBLANK(WHITE)\nPROCdraw(TRUE)\nREPEAT\n  NOUPDATE\n  PROCdraw(FALSE)\n  FOR n% = 0 TO MOLECULES%\n    PROCmove(n%)\n  NEXT\n  px% = px% + pxvel% / SPEEDRATIO%\n  py% = py% + pyvel% / SPEEDRATIO%\n  PROCdraw(TRUE)\n  UPDATE\n  PAUSE(DELAY%)\nUNTIL (ABS(px% - 500) > 490) OR (ABS(py% - 500) > 480)\nEND\n\nDEF PROCsetup\n  LOCAL n%\n  PENUP\n  px% = 500\n  py% = 500\n  pxvel% = 0\n  pyvel% = 0\n  SETXY(px%, py%)\n  COLOUR(HALOCOLOUR%)\n  BLOT(HITRADIUS%)\n  FOR n% = 0 TO MOLECULES%\n    REPEAT\n      mx%(n%) = RND(1000 - 1 * MOLRADIUS%) + MOLRADIUS%\n      my%(n%) = RND(1000 - 1 * MOLRADIUS%) + MOLRADIUS%\n    UNTIL PIXCOL(mx%(n%), my%(n%)) = WHITE\n    ms%(n%) = RND(HIGHSPEED% - SLOWSPEED%) + SLOWSPEED%\n    md%(n%) = RND(360) - 1\n    SETXY(mx%(n%), my%(n%))\n    BLOT(2 * MOLRADIUS%)\n  NEXT\nENDPROC\n\nDEF PROCdraw(positive%)\n  LOCAL n%\n  IF positive% THEN\n    COLOUR(MOLCOLOUR%)\n    radius% = MOLRADIUS%\n  ELSE\n    COLOUR(WHITE)\n    radius% = MOLRADIUS% + 1\n  ENDIF\n  FOR n% = 0 TO MOLECULES%\n    SETXY(mx%(n%), my%(n%))\n    BLOT(radius%)\n  NEXT\n  SETXY(px%, py%)\n  IF positive% THEN\n    COLOUR(POLCOLOUR%)\n    BLOT(POLRADIUS%)\n  ELSE\n    BLOT(POLRADIUS% + 1)\n  ENDIF\nENDPROC\n\nDEF PROCmove(m%)\n  LOCAL degturn%, impact%\n  SETXY(mx%(m%), my%(m%))\n  DIRECTION(md%(m%))\n  FORWARD(ms%(m%))\n  IF HYPOT(turtx% - px%, turty% - py%, 1) <= HITRADIUS% THEN\n    WHILE HYPOT(turtx% - px%, turty% - py%, 1) < HITRADIUS%\n      BACK(1)\n    ENDWHILE\n    TURNXY(px% - turtx%, py% - turty%)\n    degturn% = turtd% - md%(m%)\n    md%(m%) = (180 + (turtd% + degturn%)) MOD 360\n    impact% = COS(degturn%, 1, ms%(m%))\n    pxvel% = pxvel% + SIN(turtd%, 1, impact%)\n    pyvel% = pyvel% - COS(turtd%, 1, impact%)\n  ENDIF\n  mx%(m%) = (turtx% + 1000) MOD 1000\n  my%(m%) = (turty% + 1000) MOD 1000\nENDPROC",
  "usage":[
    {
      "category": "Turtle: relative movement",
      "expressions":[
        {"name":"BACK", "level":1, "count":1, "lines":"87"},
        {"name":"FORWARD", "level":1, "count":1, "lines":"84"}
      ],
      "total":2
    },
    {
      "category": "Turtle: absolute movement",
      "expressions":[
        {"name":"DIRECTION", "level":1, "count":1, "lines":"83"},
        {"name":"SETXY", "level":1, "count":5, "lines":"43 53 68 71 82"},
        {"name":"TURNXY", "level":2, "count":1, "lines":"89"}
      ],
      "total":7
    },
    {
      "category": "Turtle: drawing shapes",
      "expressions":[
        {"name":"BLOT", "level":1, "count":5, "lines":"45 54 69 74 76"}
      ],
      "total":5
    },
    {
      "category": "Other Turtle commands",
      "expressions":[
        {"name":"COLOUR", "level":1, "count":4, "lines":"44 61 64 73"},
        {"name":"PENUP", "level":1, "count":1, "lines":"38"}
      ],
      "total":5
    },
    {
      "category": "Canvas operations",
      "expressions":[
        {"name":"BLANK", "level":1, "count":1, "lines":"20"},
        {"name":"NOUPDATE", "level":1, "count":2, "lines":"18 23"},
        {"name":"UPDATE", "level":1, "count":1, "lines":"31"},
        {"name":"PIXCOL", "level":3, "count":1, "lines":"50"}
      ],
      "total":5
    },
    {
      "category": "General arithmetic functions",
      "expressions":[
        {"name":"ABS", "level":1, "count":2, "lines":"33 33"},
        {"name":"HYPOT", "level":2, "count":2, "lines":"85 86"},
        {"name":"RND", "level":2, "count":4, "lines":"48 49 51 52"}
      ],
      "total":8
    },
    {
      "category": "Trig / exp / log functions",
      "expressions":[
        {"name":"COS", "level":2, "count":2, "lines":"92 94"},
        {"name":"SIN", "level":2, "count":1, "lines":"93"}
      ],
      "total":3
    },
    {
      "category": "Input and timing routines",
      "expressions":[
        {"name":"PAUSE", "level":1, "count":1, "lines":"32"}
      ],
      "total":1
    },
    {
      "category": "Command structures",
      "expressions":[
        {"name":"IF", "level":1, "count":3, "lines":"60 72 85"},
        {"name":"ELSE", "level":1, "count":2, "lines":"63 75"},
        {"name":"FOR", "level":1, "count":3, "lines":"46 67 25"},
        {"name":"REPEAT", "level":2, "count":2, "lines":"47 22"},
        {"name":"WHILE", "level":2, "count":1, "lines":"86"},
        {"name":"DEF PROC", "level":2, "count":3, "lines":"36 58 80"}
      ],
      "total":14
    },
    {
      "category": "Subroutine calls",
      "expressions":[
        {"name":"PROCsetup", "level":0, "count":1, "lines":"19"},
        {"name":"PROCdraw", "level":0, "count":3, "lines":"21 24 30"},
        {"name":"PROCmove", "level":0, "count":1, "lines":"26"}
      ],
      "total":5
    }
  ],
  "pcode":[
    [112,15,1,1,112,0,123,112,6,2,123,4,112,1624,124,112,1639,138],
    [80,112,2,85,112,360,84,112,32,162,112,1,123,141,112,0,1,112,1000,1,1,1,145,144],
    [116,23,119,22],
    [112,401,119,23],
    [116,426,119,425],
    [112,401,119,426],
    [116,829,119,828],
    [112,401,119,829],
    [116,1232,119,1231],
    [112,401,119,1232],
    [128,76],
    [133,1],
    [139,12,1],
    [117,12,1,112,1,124],
    [112,0,86],
    [112,500,119,1635],
    [112,500,119,1636],
    [112,0,119,1637],
    [112,0,119,1638],
    [113,1635,113,1636,88],
    [112,16777214,87],
    [112,90,108],
    [112,0],
    [120,12,1,112,400],
    [114,12,1,37,129,34],
    [113,22,114,12,1,2,127,26,4,112,1000,112,1,112,10,28,27,7,4,112,10,26,2,123],
    [113,425,114,12,1,2,127,26,4,112,1000,112,1,112,10,28,27,7,4,112,10,26,2,123],
    [113,22,114,12,1,2,127,26,4,122,113,425,114,12,1,2,127,26,4,122,99,112,16777215,32,129,26],
    [113,828,114,12,1,2,127,26,4,112,50,112,30,27,7,4,112,30,26,2,123],
    [113,1231,114,12,1,2,127,26,4,112,360,7,4,112,1,27,2,123],
    [113,22,114,12,1,2,127,26,4,122,113,425,114,12,1,2,127,26,4,122,88],
    [112,2,112,10,28,108],
    [114,12,1,4,128,24],
    [140,12,134,132],
    [133,2],
    [139,13,2],
    [117,13,1,112,2,124,120,13,1],
    [114,13,1,129,42],
    [112,16711680,87],
    [112,10,119,1639],
    [128,44],
    [112,16777215,87],
    [112,10,112,1,26,119,1639],
    [112,0],
    [120,13,2,112,400],
    [114,13,2,37,129,50],
    [113,22,114,13,2,2,127,26,4,122,113,425,114,13,2,2,127,26,4,122,88],
    [113,1639,108],
    [114,13,2,4,128,45],
    [113,1635,113,1636,88],
    [114,13,1,129,55],
    [112,255,87],
    [112,80,108],
    [128,56],
    [112,80,112,1,26,108],
    [140,13,134,132],
    [133,3],
    [139,14,3],
    [117,14,1,112,3,124,120,14,1],
    [113,22,114,14,1,2,127,26,4,122,113,425,114,14,1,2,127,26,4,122,88],
    [113,1231,114,14,1,2,127,26,4,122,83],
    [113,828,114,14,1,2,127,26,4,122,91],
    [113,16,113,1635,27,113,17,113,1636,27,112,1,50,112,90,36,129,73],
    [113,16,113,1635,27,113,17,113,1636,27,112,1,50,112,90,34,129,67],
    [112,1,92],
    [128,64],
    [113,1635,113,16,27,113,1636,113,17,27,95],
    [113,18,113,1231,114,14,1,2,127,26,4,122,27,120,14,2],
    [113,1231,114,14,1,2,127,26,4,112,180,113,18,114,14,2,26,26,112,360,31,2,123],
    [114,14,2,112,1,113,828,114,14,1,2,127,26,4,122,58,120,14,3],
    [113,1637,113,18,112,1,114,14,3,57,26,119,1637],
    [113,1638,113,18,112,1,114,14,3,58,27,119,1638],
    [113,22,114,14,1,2,127,26,4,113,16,112,1000,26,112,1000,31,2,123],
    [113,425,114,14,1,2,127,26,4,113,17,112,1000,26,112,1000,31,2,123],
    [140,14,134,132],
    [112,0,146],
    [131,12],
    [112,16777215,96],
    [112,-1,131,35],
    [112,0,146],
    [112,0,131,35],
    [112,0],
    [119,1634,112,400],
    [113,1634,37,129,87],
    [113,1634,131,57],
    [113,1634,4,128,83],
    [113,1635,113,1637,112,10,29,26,119,1635],
    [113,1636,113,1638,112,10,29,26,119,1636],
    [112,-1,131,35],
    [112,-1,146],
    [112,50,174],
    [113,1635,112,500,27,24,112,490,35,113,1636,112,500,27,24,112,480,35,18,129,80],
    [130]
  ]
}
