{
  "format":1,
  "language":"BASIC",
  "version":13,
  "name":"Iterated Prisoner's Dilemma",
  "author":"Peter Millican",
  "date":"28/07/2020",
  "time":"13:25:36",
  "code":"REM IteratedPD\n\nCONST WIDTH%=50\nCONST HEIGHT%=50\nCONST N%=10\nDIM util%(13)\nCANVAS(0,0,WIDTH%,HEIGHT%)\nRESOLUTION(WIDTH%,HEIGHT%)\nPROCsetutilities\nNOUPDATE\nFOR i%=0 TO WIDTH%-1\n FOR j%=0 TO HEIGHT%-1\n  IF RND(50)=1 THEN\n   PIXSET(i%,j%,&0000FC)\n  ELSE\n   IF RND(7)=1 THEN\n    PIXSET(i%,j%,&00FF02)\n   ELSE\n    PIXSET(i%,j%,&FF0001)\n   ENDIF\n  ENDIF\n NEXT\nNEXT\nPAUSE(1000)\nWHILE ?KEY<>\\ESCAPE\n TIMESET(0)\n NOUPDATE\n FOR i%=0 TO WIDTH%-1\n  FOR j%=0 TO HEIGHT%-1\n   PROCutility(i%,j%)\n  NEXT\n NEXT\n FOR i%=0 TO WIDTH%-1\n  FOR j%=0 TO HEIGHT%-1\n   PROCpickbest(i%,j%)\n  NEXT\n NEXT\n FOR i%=0 TO WIDTH%-1\n  FOR j%=0 TO HEIGHT%-1\n   PROCfixbest(i%,j%)\n  NEXT\n NEXT\n UPDATE\n NOUPDATE\nENDWHILE\nEND\n\nDEF PROCutility(x%,y%)\n LOCAL this%,utot%,i%,j%,flag%\n this%=PIXCOL(x%,y%) AND &7\n utot%=0\n FOR i%=-1 TO 1\n  FOR j%=-1 TO 1\n   IF (i%<>0) OR (j%<>0) THEN\n    flag%=this% OR (PIXCOL((x%+WIDTH%+i%) MOD WIDTH%,(y%+HEIGHT%+j%) MOD HEIGHT%)) AND &F\n    utot%=utot%+util%(flag%-1)\n   ENDIF\n  NEXT\n NEXT\n PIXSET(x%,y%,utot%*&100+PIXCOL(x%,y%) AND &F)\nENDPROC\n\nDEF PROCpickbest(x%,y%)\n LOCAL i%,j%,bestsofar%\n bestsofar%=PIXCOL(x%,y%)\n IF RND(5)>=0 THEN\n  FOR i%=-1 TO 1\n   FOR j%=-1 TO 1\n    thispix%=PIXCOL((x%+WIDTH%+i%) MOD WIDTH%,(y%+HEIGHT%+j%) MOD HEIGHT%)\n    IF (thispix% AND &FFFF00)>(bestsofar% AND &FFFF00) THEN\n     bestsofar%=thispix%\n    ENDIF\n   NEXT\n  NEXT\n ENDIF\n PIXSET(x%,y%,(PIXCOL(x%,y%) AND &FFFF0F)+(bestsofar% AND &F)*&10)\nENDPROC\n\nDEF PROCfixbest(x%,y%)\n IF (PIXCOL(x%,y%) AND &10)>0 THEN\n  PIXSET(x%,y%,&FF0001)\n ELSE\n  IF (PIXCOL(x%,y%) AND &20)>0 THEN\n   PIXSET(x%,y%,&00FF02)\n  ELSE\n   PIXSET(x%,y%,&0000FC)\n  ENDIF\n ENDIF\nENDPROC\n\nDEF PROCsetutilities\n util%(0)=3*N%\n util%(1)=3*N%\n util%(2)=3*N%\n util%(4)=5*N%\n util%(5)=N%+4\n util%(11)=N%\n util%(12)=0\n util%(13)=N%-1\nENDPROC",
  "usage":[
    {
      "category": "Canvas operations",
      "expressions":[
        {"name":"NOUPDATE", "level":1, "count":3, "lines":"10 27 44"},
        {"name":"UPDATE", "level":1, "count":1, "lines":"43"},
        {"name":"CANVAS", "level":2, "count":1, "lines":"7"},
        {"name":"RESOLUTION", "level":2, "count":1, "lines":"8"},
        {"name":"PIXCOL", "level":3, "count":8, "lines":"50 55 60 65 69 76 80 83"},
        {"name":"PIXSET", "level":3, "count":8, "lines":"60 76 81 84 86 14 17 19"}
      ],
      "total":22
    },
    {
      "category": "General arithmetic functions",
      "expressions":[
        {"name":"RND", "level":2, "count":3, "lines":"66 13 16"}
      ],
      "total":3
    },
    {
      "category": "Input and timing routines",
      "expressions":[
        {"name":"PAUSE", "level":1, "count":1, "lines":"24"},
        {"name":"TIMESET", "level":2, "count":1, "lines":"26"}
      ],
      "total":2
    },
    {
      "category": "Command structures",
      "expressions":[
        {"name":"IF", "level":1, "count":7, "lines":"54 66 70 80 83 13 16"},
        {"name":"ELSE", "level":1, "count":4, "lines":"82 85 15 18"},
        {"name":"FOR", "level":1, "count":12, "lines":"52 53 67 68 11 12 28 29 33 34 38 39"},
        {"name":"WHILE", "level":2, "count":1, "lines":"25"},
        {"name":"DEF PROC", "level":2, "count":4, "lines":"48 63 79 91"}
      ],
      "total":28
    },
    {
      "category": "Subroutine calls",
      "expressions":[
        {"name":"PROCsetutilities", "level":0, "count":1, "lines":"9"},
        {"name":"PROCutility", "level":0, "count":1, "lines":"30"},
        {"name":"PROCpickbest", "level":0, "count":1, "lines":"35"},
        {"name":"PROCfixbest", "level":0, "count":1, "lines":"40"}
      ],
      "total":4
    }
  ],
  "pcode":[
    [112,16,1,1,112,0,123,112,6,2,123,4,112,25,124,112,41,138],
    [80,112,2,85,112,360,84,112,32,162,112,1,123,141,112,0,1,112,1000,1,1,1,145,144],
    [116,24,119,23],
    [112,14,119,24],
    [128,63],
    [133,1],
    [139,12,7],
    [117,12,1,112,7,124,120,12,2,120,12,1],
    [114,12,1,114,12,2,99,112,7,17,120,12,3],
    [112,0,120,12,4],
    [112,1,23],
    [120,12,5,112,1],
    [114,12,5,37,129,22],
    [112,1,23],
    [120,12,6,112,1],
    [114,12,6,37,129,21],
    [114,12,5,112,0,33,114,12,6,112,0,33,18,129,20],
    [114,12,3,114,12,1,112,50,26,114,12,5,26,112,50,31,114,12,2,112,50,26,114,12,6,26,112,50,31,99,112,15,17,18,120,12,7],
    [114,12,4,113,23,114,12,7,112,1,27,2,127,26,4,122,26,120,12,4],
    [114,12,6,4,128,15],
    [114,12,5,4,128,12],
    [114,12,1,114,12,2,114,12,4,112,256,28,114,12,1,114,12,2,99,112,15,17,26,100],
    [140,12,134,132],
    [133,2],
    [139,13,5],
    [117,13,1,112,5,124,120,13,2,120,13,1],
    [114,13,1,114,13,2,99,120,13,5],
    [112,5,7,4,112,0,37,129,40],
    [112,1,23],
    [120,13,3,112,1],
    [114,13,3,37,129,40],
    [112,1,23],
    [120,13,4,112,1],
    [114,13,4,37,129,39],
    [114,13,1,112,50,26,114,13,3,26,112,50,31,114,13,2,112,50,26,114,13,4,26,112,50,31,99,119,41],
    [113,41,112,16776960,17,114,13,5,112,16776960,17,35,129,38],
    [113,41,120,13,5],
    [114,13,4,4,128,33],
    [114,13,3,4,128,30],
    [114,13,1,114,13,2,114,13,1,114,13,2,99,112,16776975,17,114,13,5,112,15,17,112,16,28,26,100],
    [140,13,134,132],
    [133,3],
    [139,14,2],
    [117,14,1,112,2,124,120,14,2,120,14,1],
    [114,14,1,114,14,2,99,112,16,17,112,0,35,129,48],
    [114,14,1,114,14,2,112,16711681,100],
    [128,52],
    [114,14,1,114,14,2,99,112,32,17,112,0,35,129,51],
    [114,14,1,114,14,2,112,65282,100],
    [128,52],
    [114,14,1,114,14,2,112,252,100],
    [140,14,134,132],
    [133,4],
    [113,23,112,0,2,127,26,4,112,3,112,10,28,2,123],
    [113,23,112,1,2,127,26,4,112,3,112,10,28,2,123],
    [113,23,112,2,2,127,26,4,112,3,112,10,28,2,123],
    [113,23,112,4,2,127,26,4,112,5,112,10,28,2,123],
    [113,23,112,5,2,127,26,4,112,10,112,4,26,2,123],
    [113,23,112,11,2,127,26,4,112,10,2,123],
    [113,23,112,12,2,127,26,4,112,0,2,123],
    [113,23,112,13,2,127,26,4,112,10,112,1,27,2,123],
    [134,132],
    [112,0,112,0,112,50,112,50,144],
    [112,50,112,50,145],
    [131,53],
    [112,0,146],
    [112,0],
    [119,39,112,50,112,1,27],
    [113,39,37,129,82],
    [112,0],
    [119,40,112,50,112,1,27],
    [113,40,37,129,81],
    [112,50,7,4,112,1,32,129,76],
    [113,39,113,40,112,252,100],
    [128,80],
    [112,7,7,4,112,1,32,129,79],
    [113,39,113,40,112,65282,100],
    [128,80],
    [113,39,113,40,112,16711681,100],
    [113,40,4,128,71],
    [113,39,4,128,68],
    [112,1000,174],
    [112,-9,160,112,27,33,129,116],
    [112,0,173],
    [112,0,146],
    [112,0],
    [119,39,112,50,112,1,27],
    [113,39,37,129,95],
    [112,0],
    [119,40,112,50,112,1,27],
    [113,40,37,129,94],
    [113,39,113,40,131,6],
    [113,40,4,128,90],
    [113,39,4,128,87],
    [112,0],
    [119,39,112,50,112,1,27],
    [113,39,37,129,104],
    [112,0],
    [119,40,112,50,112,1,27],
    [113,40,37,129,103],
    [113,39,113,40,131,24],
    [113,40,4,128,99],
    [113,39,4,128,96],
    [112,0],
    [119,39,112,50,112,1,27],
    [113,39,37,129,113],
    [112,0],
    [119,40,112,50,112,1,27],
    [113,40,37,129,112],
    [113,39,113,40,131,42],
    [113,40,4,128,108],
    [113,39,4,128,105],
    [112,-1,146],
    [112,0,146],
    [128,83],
    [130]
  ]
}
